<div x-data>
  <h2 class="fw-bold text-center mb-4">All Products</h2>

  <!-- CATEGORY FILTERS -->
  <div class="container mb-3">
    <div class="d-flex flex-wrap justify-content-center gap-2">
      <!-- "All" button -->
      <button 
        class="btn btn-sm" 
        :class="$store.products.selectedCategory === '' ? 'btn-danger' : 'btn-outline-danger'"
        @click="$store.products.selectedCategory = ''"
      >All</button>

      <!-- Dynamic categories -->
      <template x-for="cat in $store.products.categories" :key="cat">
        <button 
          class="btn btn-sm"
          :class="$store.products.selectedCategory === cat ? 'btn-danger' : 'btn-outline-danger'"
          @click="$store.products.selectedCategory = cat"
          x-text="cat"
        ></button>
      </template>
    </div>
  </div>

  <!-- SEARCH BAR -->
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-6">
        <div class="input-group mb-3">
          <input 
            type="text" 
            class="form-control" 
            placeholder="Searching for.." 
            aria-label="Search input" 
            x-model.debounce.300ms="$store.products.searchTerm"
          >
        </div>
      </div>
    </div>
  </div>

  <!-- PRODUCTS LIST -->
  <div class="container">
    <div class="row justify-content-center p-2" x-init="$store.products.fetch()">
      <template x-if="$store.products.filtered.length === 0">
        <p class="text-center text-muted">No products found.</p>
      </template>

      <template x-for="product in $store.products.filtered" :key="product.id">
        <div class="col-6 col-sm-6 col-md-3 col-lg-2 mb-4">
          <div class="card h-100 shadow border-0" x-data>
            <img
              :src="product.image"
              class="card-img-top"
              :alt="product.title"
              style="height: 180px; object-fit: cover;"
            >

            <div class="card-body text-center">
              <h5 class="card-title" x-text="product.title"></h5>
              <p>Ksh. <span x-text="product.price"></span></p>

              <!-- Add to Cart (only when qty == 0) -->
              <template x-if="$store.cart.getQty(product.id) === 0">
                <button
                  @click="$store.cart.add(product)"
                  class="btn btn-danger w-100"
                >
                  Add to Cart
                </button>
              </template>

              <!-- Quantity controls (only when qty > 0) -->
              <template x-if="$store.cart.getQty(product.id) > 0">
                <div class="d-flex justify-content-between align-items-center">
                  <button
                    @click="$store.cart.decrement(product.id)"
                    class="btn btn-outline-danger"
                  >-</button>

                  <span class="fw-bold" x-text="$store.cart.getQty(product.id)"></span>

                  <button
                    @click="$store.cart.increment(product.id)"
                    class="btn btn-outline-success"
                  >+</button>
                </div>
              </template>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>
</div>
